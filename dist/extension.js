(()=>{"use strict";var t={119:function(t,e,n){var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.SidebarProvider=void 0;const o=n(496),r=n(855),a=i(n(13)),c=i(n(797));e.SidebarProvider=class{constructor(t,e){this._context=t,this.core=e,this.core=e,this._extensionUri=this._context.extensionUri}page(t){this.command({command:t,data:{}})}command(t){return s(this,void 0,void 0,(function*(){const e=(t=t||{}).command.split("/");switch(this.core.initLang(),e.shift()){case"vars":return this.core.vars(e.shift(),t);case"session":return this.core.session(e,t);case"page":return c.default.self(this.core,e,t);case"keys":return a.default.self(this.core,e,t)}switch(t.command){case"clear":return this.core.clear(t.content.id,t.content.data);case"reload":return this.core.postCmd("reload");case"onInfo":return this.core.winMsgInfo(t.content);case"onError":return this.core.winMsgError(t.content)}}))}resolveWebviewView(t){var e;this._view=t,null===(e=this.core)||void 0===e||e.setView(t),t.webview.options={enableScripts:!0,localResourceRoots:[this._extensionUri]},t.webview.html=this._getHtmlForWebview(t.webview),t.webview.onDidReceiveMessage((t=>s(this,void 0,void 0,(function*(){return yield this.command(t)}))))}revive(t){this._view=t}_getHtmlForWebview(t){this.core.path=""+t.asWebviewUri(o.Uri.joinPath(this._extensionUri));const e=t.asWebviewUri(o.Uri.joinPath(this._extensionUri,"assets","css/reset.css")),n=t.asWebviewUri(o.Uri.joinPath(this._extensionUri,"dist","App.css")),s=t.asWebviewUri(o.Uri.joinPath(this._extensionUri,"assets","css/vscode.css")),i=t.asWebviewUri(o.Uri.joinPath(this._extensionUri,"assets","plugins/basscss/basscss.min.css")),a=t.asWebviewUri(o.Uri.joinPath(this._extensionUri,"assets","plugins/fontawesome-6/css/all.min.css")),c=t.asWebviewUri(o.Uri.joinPath(this._extensionUri,"dist","App.js")),d=(0,r.getNonce)();return`<!DOCTYPE html>\n\t  <html lang="en">\n\t  \t<head>\n\t  \t    <meta charset="UTF-8">\n          <meta http-equiv="Content-Security-Policy" content=" font-src ${t.cspSource}; style-src ${t.cspSource}; script-src 'nonce-${d}';">\n\t  \t    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n\t  \t    <link href="${e}" rel="stylesheet">\n\t  \t    <link href="${s}" rel="stylesheet">\n          <link href="${n}" rel="stylesheet">\n          <link href="${i}" rel="stylesheet">\n          <link href="${a}" rel="stylesheet">\n\t  \t</head>\n        <body id="sidebar">\n           <script nonce="${d}" src="${c}"><\/script>\n\t  \t</body>\n\t  </html>`}}},112:function(t,e,n){var s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const i=n(496),o=n(119),r=s(n(850));e.activate=function(t){const e=new r.default("vscode-anemona-secrets",t),n=e.name,s=new o.SidebarProvider(t,e);t.subscriptions.push(i.window.registerWebviewViewProvider(n+"-sidebar",s),e.cmdReg(n+".keys",(()=>s.page("page/keys"))),e.cmdReg(n+".about",(()=>s.page("page/about"))),e.cmdReg(n+".logout",(()=>s.page("page/logout"))))},e.deactivate=function(){}},850:function(t,e,n){var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(496),o=n(147),r=n(17);class a{constructor(t,e,s){this.name=t,this.context=e,this.view=s,this.ver="0.0.8",this.lang=i.env.language||"en",this.cmdExe=i.commands.executeCommand,this.cmdReg=i.commands.registerCommand,this.ses={id:t+".session"},this.ver=n(598).i8,this.author=n(598).v,this.path="",this.data=null,this.setMenu(1)}get(t){return this.getStsGlobal(this.ses.id+t)}set(t,e){this.setStsGlobal(this.ses.id+t,e)}updSession(t){this.dataSession(t)}loadSession(){this.data=this.data?this.data:this.getStsGlobal(this.ses.id)}dataSession(t){this.data=t,this.setStsGlobal(this.ses.id,this.data)}loginSession(t,e){return s(this,void 0,void 0,(function*(){if(t&&t.file&&(0,o.existsSync)(t.file))return t.id=(0,r.basename)(t.file),t.name=t.id.replace(".secrets",""),t.path=(0,r.dirname)(t.file),this.setSession(t),e(this.data,2);e(null,1)}))}setSession(t){this.updSession(t)}globalSession(t){if(this.loadSession(),this.data&&this.data.id){const e=this.data;e.lang=this.lang,e.success=!0,this.setSession(this.data),t(e,2)}else t({success:!1,lang:this.lang},1)}initSession(t,e){this.setSession(t),e({success:!0,lang:this.lang},2)}dropSession(t){this.data=null,this.setStsGlobal("keys-anemona",[]),this.setStsGlobal(this.ses.id,this.data),t({success:!0},1)}routeSession(t,e,n){switch(t.shift()){case"global":return this.globalSession(n);case"init":return this.initSession(e,n);case"drop":return this.dropSession(n);case"login":return this.loginSession(e,n)}}session(t,e){const n="session/"+t.join("/");this.postCmd("lang",this.lang),this.routeSession(t,e.content,((t,e)=>{this.setMenu(e),this.postCmd(n,t||{})}))}vars(t,e){this.postCmd(e.command,this.getStsGlobal(t)||{})}clear(t,e=null){this.setStsGlobal(t,e)}initLang(){this.lang=this.lang}loadLang(t,e){this.postCmd(e.command,this.lang)}setLang(t){this.lang=t,this.setStsGlobal("lang",t)}getStsGlobal(t){return this.context.globalState.get(t)}setStsGlobal(t,e){this.context.globalState.update(t,e),this.context.globalState.setKeysForSync([t])}delStsGlobal(t){this.context.globalState.update(t,void 0)}setCtx(t,e){this.cmdExe("setContext",this.name+"."+t,e)}setMenu(t){this.setCtx("idMenuOption",t)}postCmd(t,e={}){var n;null===(n=this.view)||void 0===n||n.webview.postMessage({cmd:t,dat:e})}setView(t){this.view=t}winMsgInfo(t){t&&i.window.showInformationMessage(t)}winMsgError(t){t&&i.window.showErrorMessage(t)}winOpenImage(){return s(this,void 0,void 0,(function*(){return yield i.window.showOpenDialog({title:"es"===this.lang?"Selecciona una imagen":"Select an image",canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Images:["png","jpg"]}})}))}winOpenFile(t){return s(this,void 0,void 0,(function*(){return yield i.window.showOpenDialog({canSelectFiles:!0,canSelectFolders:!1,canSelectMany:!1,filters:{Files:t}})}))}winSaveFile(t){return s(this,void 0,void 0,(function*(){return yield i.window.showSaveDialog({filters:{Files:t}})}))}}e.default=a,a.id="iH5421"},455:function(t,e,n){var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(850)),r=n(113),a=["6CFBD07E","3737","4D2B","BC9C","1B0648ADAC21"],c=["aes","256","cbc"];class d{constructor(t){this.core=t}static self(t,e,n){return d.me||(d.me=t?new d(t):void 0),d.me&&e&&d.me.router(e,n),d.me}static md5(t){return(0,r.createHash)("md5").update(t).digest("hex")}static b64Encode(t){return Buffer.from(t,"utf-8").toString("base64")}static b64Decode(t){return Buffer.from(t,"base64").toString("utf-8")}static encode(t,e){e=d.md5(o.default.id+e+a.join("-"));const n=(0,r.randomBytes)(32).toString("base64").substring(0,13);let s=Buffer.from(d.md5(n),"hex"),i=(0,r.createCipheriv)(c.join("-"),Buffer.from(e),s),l=i.update(t);return l=Buffer.concat([l,i.final()]),n+l.toString("base64")}static decode(t,e){e=d.md5(o.default.id+e+a.join("-"));let n=Buffer.from(d.md5(t.substring(0,13)),"hex"),s=Buffer.from(t.substring(13),"base64"),i=(0,r.createDecipheriv)(c.join("-"),Buffer.from(e),n),l=i.update(s);return l=Buffer.concat([l,i.final()]),l.toString()}router(t,e){return s(this,void 0,void 0,(function*(){switch(t.shift()){case"encode":return this.getEncode(e);case"decode":return this.getDecode(e)}}))}getDecode(t){return s(this,void 0,void 0,(function*(){const e=t.content;let n=d.decode(e.data,e.key);e.json&&(n=JSON.parse(n)),this.core.postCmd(t.command,n)}))}getEncode(t){return s(this,void 0,void 0,(function*(){const e=t.content;let n=d.encode(e.data,e.key);e.json&&(n=JSON.parse(n)),this.core.postCmd(t.command,n)}))}}e.default=d},13:function(t,e,n){var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=i(n(455)),r=n(496),a=n(147),c="keys-anemona";class d{constructor(t){this.core=t}static self(t,e,n){return d.me||(d.me=t?new d(t):void 0),d.me&&e&&d.me.router(e,n),d.me}static putFileContent(t,e){e=e||{},(0,a.writeFileSync)(t,JSON.stringify(e),{encoding:"UTF-8"})}static getFileContent(t){const e=(0,a.readFileSync)(t,{encoding:"UTF-8"});let n={};try{n=JSON.parse(e)}catch(t){n={}}return n}router(t,e){return s(this,void 0,void 0,(function*(){switch(t.shift()){case"new":return this.newDocument(e);case"open":return this.openDocument(e);case"get":return this.getContent(e);case"save":return this.saveContent(e);case"lock":return this.lockContent(e);case"unlock":return this.unlockContent(e);case"export":return this.exportContent(e);case"recent":return this.recent(e)}}))}addRecent(t){if(!t)return;let e=this.core.getStsGlobal("recent");e=e instanceof Array?e:[];const n=e.indexOf(t);n>-1&&e.splice(n,1),e.length>20&&e.pop(),e.unshift(t),this.core.setStsGlobal("recent",e)}newDocument(t){return s(this,void 0,void 0,(function*(){let e="";const n=yield this.core.winSaveFile(["secrets"]);if(n){e=n.fsPath;const t={id:o.default.md5(e)};d.putFileContent(e,t)}this.addRecent(e),this.core.postCmd(t.command,e)}))}openDocument(t){return s(this,void 0,void 0,(function*(){let e="";const n=yield this.core.winOpenFile(["secrets"]);n&&n.length&&(e=n[0].fsPath,this.addRecent(e)),this.core.postCmd(t.command,e)}))}getContent(t){const e=t.content;let n={};(0,a.existsSync)(e.file)?(n=d.getFileContent(e.file),n.id||(n.id=n.id||o.default.md5(e.file),d.putFileContent(e.file,n)),n.lock||(n.data?n.data=JSON.parse(o.default.decode(n.data,n.id)):n.data=[]),n.clue&&(n.clue=o.default.decode(n.clue,n.id))):(n={error:404,message:'El archivo "'+e.file+'" no localizado...'},this.core.winMsgError(n.message)),this.core.postCmd(t.command,n)}saveContent(t){return s(this,void 0,void 0,(function*(){const e=t.content;e.data.lock=!1;let n=e.data;n.data=o.default.encode(JSON.stringify(e.data.data),n.id),d.putFileContent(e.key.file,n),this.core.postCmd(t.command,{success:!0})}))}exportContent(t){return s(this,void 0,void 0,(function*(){const e=t.content;let n="";if("txt"===e.format)for(const t in e.data){n+="\n";for(const s in e.data[t])n+="\n"+s+": "+e.data[t][s]}else{if(n=e.data,"key"===e.format){const t=o.default.md5(Math.random()+c);n={type:c,uid:t,data:o.default.encode(JSON.stringify(e.data),t+c)}}n=JSON.stringify(n,null,4)}const s=yield r.workspace.openTextDocument({content:n,language:"txt"===e.format?"txt":"json"});yield r.window.showTextDocument(s),this.core.postCmd(t.command,{success:!0})}))}unlockContent(t){return s(this,void 0,void 0,(function*(){const e=t.content,n=e.key,s=e.data;let i="";e.pwd||this.core.postCmd(t.command,{error:!0});try{i=o.default.decode(s.data,e.pwd+s.id)}catch(e){return this.core.postCmd(t.command,{error:!0})}const r={id:s.id,lock:!1,data:o.default.encode(i,s.id),order:s.order?1:0};d.putFileContent(n.file,r),r.data=JSON.parse(i),this.core.postCmd(t.command,r)}))}lockContent(t){const e=t.content,n=e.key,s=e.data;e.pwd||this.core.postCmd(t.command,{error:!0}),s.data=o.default.encode(JSON.stringify(s.data),e.pwd+s.id),s.lock=!0,s.clue=o.default.encode(e.clue||"*",s.id),d.putFileContent(n.file,s),s.clue="*",this.core.postCmd(t.command,s)}recent(t){const e=this.core.getStsGlobal("recent")||[],n=[];if(e.length){let t=!1;for(const s in e)(0,a.existsSync)(e[s])?n.push(e[s]):t=!0;t&&this.core.setStsGlobal("recent",n)}this.core.postCmd(t.command,n)}}e.default=d},797:function(t,e){var n=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function r(t){try{c(s.next(t))}catch(t){o(t)}}function a(t){try{c(s.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});class s{constructor(t){this.core=t}static self(t,e,n){return s.me||(s.me=t?new s(t):void 0),s.me&&e&&s.me.router(e,n),s.me}router(t,e){return n(this,void 0,void 0,(function*(){switch(t.shift()){case"about":return this.core.postCmd("page/about");case"keys":case"keys":return this.core.postCmd("page/keys");case"logout":return this.core.postCmd("page/logout");case"login":return this.core.postCmd("page/login");case"langEs":return this.changeLanguage("es");case"langEn":return this.changeLanguage("en")}}))}changeLanguage(t){return n(this,void 0,void 0,(function*(){this.core.setLang(t),this.core.data&&this.core.data.id?this.core.setMenu(2):this.core.setMenu(1),yield this.core.cmdExe(this.core.name+".refresh")}))}}e.default=s},855:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getNonce=void 0,e.getNonce=function(){let t="";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<32;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}},496:t=>{t.exports=require("vscode")},113:t=>{t.exports=require("crypto")},147:t=>{t.exports=require("fs")},17:t=>{t.exports=require("path")},598:t=>{t.exports=JSON.parse('{"i8":"0.0.1","v":{"name":"Martin R. Mondragón","email":"martin@anemona.com"}}')}},e={},n=function n(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,n),o.exports}(112);module.exports=n})();
//# sourceMappingURL=extension.js.map